name: Credentials Integration Tests

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main, develop ]
  workflow_dispatch:

jobs:
  credentials-tests:
    runs-on: ubuntu-latest
          
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Setup PHP
      uses: shivammathur/setup-php@v2
      with:
        php-version: '8.1'
        extensions: json, curl, gd, zip
        tools: composer
        
    - name: Install dependencies
      run: |
        cd backend
        composer install --no-dev --optimize-autoloader
        
    - name: Basic syntax check
      run: |
        echo "üîç V√©rification de la syntaxe PHP..."
        find backend -name "*.php" -exec php -l {} \;
        echo "‚úÖ Syntaxe PHP correcte"
        
    - name: Check required files
      run: |
        echo "üìã V√©rification des fichiers requis..."
        
        # V√©rifier que les fichiers principaux existent
        required_files=(
          "backend/app.php"
          "backend/index.php"
          "backend/composer.json"
          "Dockerfile"
          "cloudbuild.yaml"
          "README.md"
        )
        
        for file in "${required_files[@]}"; do
          if [ ! -f "$file" ]; then
            echo "‚ùå Fichier manquant: $file"
            exit 1
          fi
          echo "‚úÖ $file trouv√©"
        done
        
        echo "‚úÖ Tous les fichiers requis sont pr√©sents"
        
    - name: Test results summary
      run: |
        echo "üéâ Tests de base termin√©s avec succ√®s !"
        echo "   - Syntaxe PHP: ‚úÖ"
        echo "   - Fichiers requis: ‚úÖ"
        echo "   - D√©pendances: ‚úÖ"
