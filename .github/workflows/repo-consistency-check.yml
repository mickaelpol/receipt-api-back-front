name: Repository Consistency Check

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main, develop ]

jobs:
  consistency-check:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
        
    - name: Check for multiple READMEs
      run: |
        echo "🔍 Vérification des README multiples..."
        README_COUNT=$(find . -name "README.md" -not -path "./.git/*" | wc -l)
        if [ "$README_COUNT" -gt 1 ]; then
          echo "❌ Plusieurs README.md trouvés:"
          find . -name "README.md" -not -path "./.git/*"
          exit 1
        else
          echo "✅ Un seul README.md trouvé"
        fi
        
    - name: Check project structure
      run: |
        echo "🔍 Vérification de la structure du projet..."
        EXPECTED_DIRS=("frontend" "backend" "infra" "scripts")
        for dir in "${EXPECTED_DIRS[@]}"; do
          if [ ! -d "$dir" ]; then
            echo "❌ Dossier $dir manquant"
            exit 1
          else
            echo "✅ Dossier $dir présent"
          fi
        done
        
    - name: Check for temporary files
      run: |
        echo "🔍 Vérification des fichiers temporaires..."
        TEMP_FILES=$(find . -name "*.tmp" -o -name "*.log" -o -name "*.cache" -o -name ".DS_Store" -not -path "./.git/*" -not -path "./node_modules/*" -not -path "./vendor/*" 2>/dev/null || true)
        if [ -n "$TEMP_FILES" ]; then
          echo "⚠️ Fichiers temporaires détectés:"
          echo "$TEMP_FILES"
          echo "💡 Considérez les supprimer pour maintenir la propreté du repo"
        else
          echo "✅ Aucun fichier temporaire trouvé"
        fi
        
    - name: Summary
      run: |
        echo ""
        echo "🎉 Vérifications de consistance terminées !"
        echo "   - Structure du projet ✅"
        echo "   - README unique ✅"
        echo "   - Fichiers temporaires vérifiés ✅"
