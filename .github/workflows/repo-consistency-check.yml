name: Repository Consistency Check

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main, develop ]

jobs:
  consistency-check:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
        
    - name: Check for multiple READMEs
      run: |
        echo "ğŸ” VÃ©rification des README multiples..."
        README_COUNT=$(find . -name "README.md" -not -path "./.git/*" | wc -l)
        if [ "$README_COUNT" -gt 1 ]; then
          echo "âŒ Plusieurs README.md trouvÃ©s:"
          find . -name "README.md" -not -path "./.git/*"
          exit 1
        else
          echo "âœ… Un seul README.md trouvÃ©"
        fi
        
    - name: Check project structure
      run: |
        echo "ğŸ” VÃ©rification de la structure du projet..."
        EXPECTED_DIRS=("frontend" "backend" "infra" "scripts")
        for dir in "${EXPECTED_DIRS[@]}"; do
          if [ ! -d "$dir" ]; then
            echo "âŒ Dossier $dir manquant"
            exit 1
          else
            echo "âœ… Dossier $dir prÃ©sent"
          fi
        done
        
    - name: Check for temporary files
      run: |
        echo "ğŸ” VÃ©rification des fichiers temporaires..."
        TEMP_FILES=$(find . -name "*.tmp" -o -name "*.log" -o -name "*.cache" -o -name ".DS_Store" -not -path "./.git/*" -not -path "./node_modules/*" -not -path "./vendor/*" 2>/dev/null || true)
        if [ -n "$TEMP_FILES" ]; then
          echo "âš ï¸ Fichiers temporaires dÃ©tectÃ©s:"
          echo "$TEMP_FILES"
          echo "ğŸ’¡ ConsidÃ©rez les supprimer pour maintenir la propretÃ© du repo"
        else
          echo "âœ… Aucun fichier temporaire trouvÃ©"
        fi
        
    - name: Summary
      run: |
        echo ""
        echo "ğŸ‰ VÃ©rifications de consistance terminÃ©es !"
        echo "   - Structure du projet âœ…"
        echo "   - README unique âœ…"
        echo "   - Fichiers temporaires vÃ©rifiÃ©s âœ…"
