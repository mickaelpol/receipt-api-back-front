/* ---------- Thème de base ---------- */
:root {
    --bg: #0b0f14;
    --panel: #121822;
    --panel-2: #0e141d;
    --border: #182234;
    --muted: #9db2d0;
    --text: #f5f6f7;
    --brand: #4388ff;
    --ok: #2a7a5c;
    --warn: #f0c148;
    --danger: #cc4151;
    --radius: 12px;
    --gap: 12px;
}

* { box-sizing: border-box; }
html, body { height: 100%; }
body {
    margin: 0;
    background: var(--bg);
    color: var(--text);
    font: 15px/1.4 system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji";
}

/* ---------- Containers ---------- */
.section {
    background: var(--panel);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 16px;
    margin: 12px;
}
.section + .section { margin-top: 0; }

/* ---------- Titres + petites infos ---------- */
.h1 {
    font-size: 20px;
    font-weight: 800;
    margin: 0 0 8px 0;
    text-align: center;
}
.subtle { color: var(--muted); font-size: 13px; }

/* ---------- Formulaires ---------- */
label.form-label {
    display:block; font-weight:600; margin-bottom:6px;
}
.form-control, .form-select {
    width: 100%;
    background: var(--panel-2);
    border: 1px solid var(--border);
    color: var(--text);
    padding: 10px 12px;
    border-radius: 10px;
}
.form-control:focus, .form-select:focus {
    outline: none; border-color: #3a6bd8; box-shadow: 0 0 0 3px rgba(67,136,255,.15);
}
.btn {
    display:inline-flex; align-items:center; justify-content:center; gap:8px;
    border: 1px solid var(--border); color: var(--text);
    padding: 10px 14px; background: var(--panel-2); border-radius: 10px;
    cursor: pointer; text-decoration: none; user-select: none;
}
.btn:disabled { opacity:.6; cursor:not-allowed; }
.btn-primary { background: linear-gradient(180deg,#4a8fff,#356fe7); border-color:#2e60cd; }
.btn-success { background: linear-gradient(180deg,#2f8b69,#257a5c); border-color:#1f6a50; }
.btn-warning { background: linear-gradient(180deg,#ffd66a,#ffbf45); border-color:#e2a32f; color:#372800; }
.btn-danger  { background: linear-gradient(180deg,#e16474,#cd4a5b); border-color:#b43c4b; }

/* ---------- Segmented control (Qui scanne ?) ---------- */
.seg {
    display:flex; gap:6px; background:var(--panel-2); border:1px solid var(--border); border-radius:999px; padding:4px;
}
.seg input { display:none; }
.seg label {
    flex:1; text-align:center; padding:8px 10px; border-radius:999px; font-weight:600; color:var(--muted);
    border:1px dashed transparent; cursor:pointer; white-space:nowrap;
}
.seg input:checked + label {
    color:#fff; background: linear-gradient(180deg,#1f2a3b,#192333);
    border-color:#2a3a54;
}

/* ---------- Zone d’aperçu (mode simple) ---------- */
.preview-wrap{
    --preview-h: 46vh; /* mobile par défaut */
    border: 2px dashed rgba(255,255,255,0.16);
    border-radius: var(--radius);
    min-height: 160px;
    height: var(--preview-h);
    display:flex; align-items:center; justify-content:center;
    background: var(--panel-2);
}
#preview{ display:none; width:100%; height:100%; object-fit:contain; }
.preview-wrap.has-image #preview{ display:block; }
@media (min-width: 768px){ .preview-wrap{ --preview-h: 58vh; } }

/* ---------- Grille de cartes (mode multi) ---------- */
#multiCards { display:grid; grid-template-columns: 1fr; gap: 14px; }
#multiCards > * { min-width:0; }
@media (min-width: 768px)  { #multiCards { grid-template-columns: repeat(2, minmax(0,1fr)); } }
@media (min-width: 1024px) { #multiCards { grid-template-columns: repeat(3, minmax(0,1fr)); } }
@media (min-width: 1280px) { #multiCards { grid-template-columns: repeat(4, minmax(0,1fr)); } }

.card {
    background: var(--panel-2);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 10px;
}
.card img { width:100%; height:auto; object-fit:contain; border-radius: 8px; }

/* Ligne d’état dans chaque carte */
.card .small { color: var(--muted); margin-bottom: 6px; }

/* ---------- Empty state (mode multi, avant upload) ---------- */
#multiEmpty {
    display:flex; align-items:center; justify-content:center; text-align:center;
    border:2px dashed rgba(255,255,255,0.18);
    border-radius: var(--radius);
    padding: 22px;
    background: var(--panel-2);
    color: var(--muted);
}
#multiEmpty .inner {
    max-width: 460px; display:flex; flex-direction:column; gap:12px; align-items:center;
}
#multiEmpty .emoji { font-size: 28px; }
#multiEmpty .hint  { font-size: 14px; }
#multiEmpty .pick  { display:inline-flex; align-items:center; gap:8px; }

/* ---------- Statusbar ---------- */
.statusbar { color: var(--muted); font-size: 13px; padding: 8px 12px; }

/* ---------- Barre d’actions flottante ---------- */
.fab-wrap {
    position: fixed; left: 0; right: 0; bottom: 0;
    padding: 8px;
    padding-bottom: calc(8px + env(safe-area-inset-bottom, 0px));
    z-index: 10000;
    pointer-events: none;
}
.fab-bar {
    pointer-events: auto;
    display:flex; align-items:center; justify-content:center; gap:8px;
    max-width: 960px; margin: 0 auto;
    background: rgba(15,15,20,0.85);
    backdrop-filter: blur(8px);
    border: 1px solid rgba(255,255,255,0.12);
    border-radius: 14px;
    padding: 10px;
    box-shadow: 0 12px 34px rgba(0,0,0,.35);
}
.fab-bar .btn { padding: 10px 12px; }
@media (max-width: 480px){ .fab-bar .btn { padding: 9px 10px; font-size: .95rem; } }

/* Laisse de la place pour la barre pour éviter qu’elle recouvre les cards */
.fab-spacer { height: 76px; }


.card .form-label {
    color: #d7e3f3;        /* clair */
    opacity: 0.95;
}

/* Badges de statut */
.status-badge{
    display:inline-block;
    font-weight:700;
    font-size:13px;
    padding:0;                 /* pas de pastille */
    margin: 6px 0 10px 0;
    border: none;              /* pas de bordure */
    background: transparent;   /* pas de fond */
}

.status-analyse{ color:#F0B34A; }  /* orange doux pendant l’analyse */
.status-ok{       color:#30C08A; } /* vert quand c’est OK */
.status-error{    color:#E26A76; } /* rouge doux si erreur */

/* ==== FAB ronds (flottants) ==== */
.fab-wrap {
    position: fixed;
    left: 0; right: 0; bottom: 10px;
    display: flex; justify-content: center; gap: 14px;
    z-index: 10000;
    pointer-events: none;        /* clics seulement sur les boutons */
}

.fab-btn {
    pointer-events: auto;
    width: 58px; height: 58px;
    border-radius: 50%;
    display: inline-flex; align-items: center; justify-content: center;
    border: 1px solid rgba(255,255,255,.18);
    box-shadow: 0 12px 30px rgba(0,0,0,.35);
    backdrop-filter: blur(8px);
    transition: transform .12s ease, box-shadow .12s ease, opacity .2s;
    cursor: pointer;
}

/* icône centrée, grande */
.fab-icon { font-size: 28px; line-height: 1; transform: translateY(-1px); }

/* variantes */
.fab-add   { background: linear-gradient(180deg,#2b6ff7,#1a53c7); color:#fff; }
.fab-save  { background: linear-gradient(180deg,#1f8f6d,#15684f); color:#fff; }
.fab-clear { background: linear-gradient(180deg,#db4455,#b12a39); color:#fff; }

.fab-btn:hover { transform: translateY(-2px); box-shadow: 0 16px 36px rgba(0,0,0,.45); }

.fab-btn:disabled,
.fab-btn.is-disabled {
    opacity: .45;
    cursor: not-allowed;
    filter: grayscale(.3);
}

/* laisse de la place au bas de la page */
.fab-spacer { height: 84px; }

/* Responsive : boutons un peu plus petits sur mobile étroit */
@media (max-width: 420px) {
    .fab-btn { width: 54px; height: 54px; }
    .fab-icon { font-size: 26px; }
}
/* =========================
   MOBILE/TABLET FIXES ≤ 768
   ========================= */
@media (max-width: 768px) {

    /* -- 1) Ligne Auth: forcer l'empilement -- */
    /* Cas moderne : si le parent est un conteneur flex, on le passe en colonne */
    .section:has(#authStatus, #btnSwitch) {
        display: block;
    }

    /* S'il y a un wrapper flex autour, ça force la casse de ligne */
    #authStatus {
        display: block !important;
        flex: 0 0 100% !important;
        width: 100% !important;
        text-align: center !important;
        margin: 6px auto 8px auto !important;
    }
    #btnSwitch, #btnAuth {
        display: block !important;
        flex: 0 0 100% !important;
        width: 100% !important;
        max-width: 280px !important;
        margin: 0 auto 10px auto !important;
    }

    /* Select feuille centré */
    #sheetSelect {
        width: 100% !important;
        max-width: 280px !important;
        margin-left: auto !important;
        margin-right: auto !important;
    }

    /* -- 2) Segmented control en liste verticale -- */
    .seg {
        display: grid !important;
        grid-template-columns: 1fr !important;
        gap: 8px !important;
        padding: 8px !important;
        border-radius: 16px !important;
        overflow: hidden;                /* évite les débords ronds laids */
        background: var(--panel-2) !important;
    }
    .seg label {
        display: block !important;
        width: 100% !important;
        white-space: normal !important;
        text-align: center !important;
        padding: 12px 14px !important;
        border-radius: 999px !important;
        font-weight: 700 !important;
        color: var(--muted) !important;
        border: 1px solid var(--border) !important;
        background: linear-gradient(180deg,#141d2a,#0f1622) !important;
    }
    .seg input:checked + label {
        color: #fff !important;
        border-color: #2a3a54 !important;
        background: linear-gradient(180deg,#1f2a3b,#192333) !important;
    }
}

/* Ultra-petits écrans : réduire un peu les paddings */
@media (max-width: 380px) {
    .seg label { padding: 10px 12px !important; }
}

/* =========================
   Auth block: stack on mobile
   ========================= */
@media (max-width: 768px) {
    /* Kill any inline/flex that keeps them side-by-side */
    #authStatus,
    #btnAuth,
    #btnSwitch {
        display: block !important;
        flex: 0 0 100% !important;
        width: 100% !important;
        max-width: 320px !important;
        margin-left: auto !important;
        margin-right: auto !important;
        margin-top: 6px !important;
        margin-bottom: 8px !important;
        text-align: center !important;
        white-space: normal !important;       /* allow wrapping */
        overflow-wrap: anywhere !important;   /* long emails won't push width */
        word-break: break-word !important;
        float: none !important;
        clear: both !important;
    }

    /* Make the button full width but nice */
    #btnAuth,
    #btnSwitch {
        max-width: 280px !important;
    }

    /* Just in case parent is a flex row: force wrapping context */
    #authStatus,
    #btnAuth,
    #btnSwitch {
        min-width: 0 !important;
    }

    /* Prevent any horizontal overflow in the first section */
    .section { overflow-x: clip; }
    body { overflow-x: hidden; }
}

@media (max-width: 992px) {
    /* Le parent recevra .auth-stack via JS */
    .auth-stack {
        display: grid !important;
        grid-template-columns: 1fr;
        justify-items: center;
        row-gap: 8px;
    }
    .auth-stack #authStatus,
    .auth-stack #btnAuth,
    .auth-stack #btnSwitch {
        width: 100% !important;
        max-width: 280px !important;
        margin: 0 !important;
        text-align: center !important;
        white-space: normal !important;
        overflow-wrap: anywhere !important;
        word-break: break-word !important;
    }
    .auth-stack #btnAuth[style*="display: none"] {
        display: none !important;
    }

    /* Sécurité anti-scroll horizontal */
    body { overflow-x: hidden; }
}